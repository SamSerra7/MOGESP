@model IEnumerable<String>
@{
    ViewData["Title"] = "Primeros Ingresos";
}

<!DOCTYPE html>
<html>

<head>

    <script src='https://code.jquery.com/jquery-2.2.4.min.js'></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.15/js/jquery.dataTables.min.js"></script>
    <link href="https://cdn.datatables.net/1.10.15/css/jquery.dataTables.min.css" rel="stylesheet" />


</head>

<body>

    <br><br>
    <div style="width:810px; padding:3px;">
        <div class="col-md-12 col-xs-12 col-sm-12">
            <center>
                <h2>Cuadro General</h2>
            </center>
        </div>
        <br />
        <div class="col-md-12 col-xs-12 col-sm-12 col-lg-12">
            <hr />
        </div>
        <br />
        <div>
            <h6>No.Convocatoria</h6>
            <select class="browser-default custom-select" id="buscarNumConvocatoria">
                <option value="AA">Todas</option>
                @foreach (var convocatoria in Model)
                {
                    <option value="@convocatoria">
                        @convocatoria
                    </option>
                }
            </select>
            <h6>No.Flujo</h6>
            <select class="browser-default custom-select" id="buscarNumFlujo">
                <option value="0">Todos</option>
            </select>
            <button id="btn_BuscarFLCV">Buscar</button>

        </div>
        <br><br><br><br>
        <div class="form-group" style="width:80px; float:left;">

            <h4>Nombrados:</h4> <input type="text" size="15" maxlength="30" name="txtNombrado" disabled>
            <h4>Positivos:</h4> <input type="text" size="15" maxlength="30" name="txtPositivo" disabled>

        </div>

        <div class="form-group" style="width:300px; float:right;">

            <h4>En Espera:</h4> <input type="text" size="15" maxlength="30" name="txtEspera" disabled>
            <h4>Negativos:</h4> <input type="text" size="15" maxlength="30" name="txtNegativos" disabled>

        </div>

    </div>

    <br><br><br><br><br><br><br><br><br><br>

    <!--Tabla Resumen de días-->
    <div class="table-responsive col-md-12 col-xs-12 col-sm-12" style="text-align: center; overflow-y: auto;">
        <table id="tablaDeps" class="table table-bordered table-responsive table-hover">
            <thead style="align-content: center;">
                <tr style=" background-color: #222;" class="btn-primary">

                    <th scope="col">
                        Gesti&oacute;n Humana - Administraci&oacute;n
                        <hr>Cantidad-Casos en Tr&aacute;mite
                    </th>
                    <th scope="col">
                        Antecedentes
                        <hr>Cantidad-Casos en Tr&aacute;mite
                    </th>
                    <th scope="col">
                        Transportes
                        <hr>Cantidad-Casos en Tr&aacute;mite
                    </th>
                    <th scope="col">
                        M&eacute;dicas
                        <hr>Cantidad-Casos en Tr&aacute;mite
                    </th>
                    <th scope="col">
                        Toxolog&iacute;a
                        <hr>Cantidad-Casos en Tr&aacute;mite
                    </th>

                </tr>
            </thead>

            <tbody>

                <tr>

                    <th scope="row">1</th>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>

                </tr>

            </tbody>

        </table>

    </div>

    <br><br><br><br><br><br><br><br>

    <h4>Filtros:</h4>

    <br>

    <div style="width:200px; float:left;">

        <select class="browser-default custom-select">
            <option selected value="0">Todos</option>
            <option value="1">One</option>
            <option value="2">Two</option>
            <option value="3">Three</option>
        </select>

    </div>

    <div style="width:200px; float:left;">

        <select class="browser-default custom-select">
            <option selected value="0">Todos</option>
            <option value="1">One</option>
            <option value="2">Two</option>
            <option value="3">Three</option>
        </select>

    </div>




    <br><br><br><br>

    <!--Tabla Cuadro General-->
    <div class="table-responsive col-md-12 col-xs-12 col-sm-12" style="text-align: center; overflow-y: auto;">
        <table id="tablaPrimerosIngresos" class="table table-bordered table-responsive table-hover">
            <thead style="align-content: center;">
                <tr style=" background-color: #222;" class="btn-primary">
                    <th class="border-top-left"></th>
                    <th class="centrarTitulos">N&deg;. Concurso</th>
                    <th class="centrarTitulos">Ubicaci&oacute;n</th>
                    <th class="centrarTitulos">N&deg;. C&eacute;dula</th>
                    <th class="centrarTitulos">Nombre</th>
                    <th class="centrarTitulos">INVESTIGADOR 1</th>
                    <th class="centrarTitulos">CUSTODIO DE DETENIDOS</th>
                    <th class="centrarTitulos">AGENTE DE PROTECCION 1</th>
                    <th class="centrarTitulos">INVESTIGADOR DE LOCALIZACION Y PRES</th>
                    <th class="centrarTitulos">
                        Tr&aacute;mite
                        <br>Administraci&oacute;n
                    </th>
                    <th class="centrarTitulos">
                        Pruebas
                        <br>Psicol&oacute;gicas-Psicom&eacute;tricas
                    </th>
                    <th class="centrarTitulos">
                        Tr&aacute;mite
                        <br>Administraci&oacute;n
                    </th>
                    <th class="centrarTitulos">
                        Invest.
                        <br>De Antecedentes
                    </th>
                    <th class="centrarTitulos">
                        Tr&aacute;mite
                        <br>Administraci&oacute;n
                    </th>
                    <th class="centrarTitulos">Vialidad</th>
                    <th class="centrarTitulos">
                        Fecha Envio a GH
                        <br>Traslado a Nueva Etapa
                    </th>
                    <th class="centrarTitulos">
                        Tr&aacute;mite
                        <br>Administraci&oacute;n
                    </th>
                    <th class="centrarTitulos">Pruebas M&eacute;dicas</th>
                    <th class="centrarTitulos">
                        Tr&aacute;mite
                        <br>Administraci&oacute;n
                    </th>
                    <th class="centrarTitulos">Toxicolog&iacute;a</th>
                    <th class="centrarTitulos">
                        Instancia en que
                        <br>Perdi&oacute; el Proceso
                    </th>
                    <th class="centrarTitulos">Condici&oacute;n</th>

                    <th class="centrarTitulos">Fecha Ingreso</th>
                    <th class="centrarTitulos">
                        Cantidad Total
                        <br>D&iacute;as en Tr&aacute;mite
                    </th>

                </tr>
            </thead>

            <tr style="background:#f1f1f1">
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>

        </table>

    </div>
    <script>
        var btn_BuscarFLCV = $("#btn_BuscarFLCV");
        var selectFlujos = $("#buscarNumFlujo");
        var selectConvocatoria = $("#buscarNumConvocatoria");
        var tablaPrimerosIngresos = $("#tablaPrimerosIngresos");
        //$(document).ready(function () {
        //btn_BuscarFLCV.prop("disabled", true);

        //});
        
        var nombrePI = "";
        var investigador1 = "N/A";
        var agenteDeProteccion = "N/A";
        var custodioDeDetenidos = "N/A";
        var agenteDeLocalizacion = "N/A";
        $("#btn_BuscarFLCV").click(function () {
            
            tablaPrimerosIngresos.find("tr:gt(0)").remove(); 
            var url2 = "http://localhost:55439/api/cuadroGeneral/listaPI/" + selectConvocatoria.val() + "/" + selectFlujos.val();
            console.log(url2);
            
            $.post(url2, null, function (data) {
                console.log(data)
                if (data.length === 0) {
                    alert("El cuadro general seleccionado esta vacio");
                } else {
                    

                    for (key in data) {
                        investigador1 = "N/A";
                        agenteDeProteccion = "N/A";
                        custodioDeDetenidos = "N/A";
                        agenteDeLocalizacion = "N/A";
                        if (data.hasOwnProperty(key)) {
                            nombrePI = "" + data[key].nombrePI + " " + data[key].primerApellido + " " + data[key].segundoApellido;
                            for (puestoKey in data[key].puestosAplica) {
                                if (data[key].puestosAplica[puestoKey].idPuesto == 1111) {
                                    investigador1 = "" + data[key].puestosAplica[puestoKey].nombre;

                                } else if (data[key].puestosAplica[puestoKey].idPuesto == 2222) {
                                    agenteDeProteccion = "" + data[key].puestosAplica[puestoKey].nombre;

                                } else if (data[key].puestosAplica[puestoKey].idPuesto == 3333) {
                                    custodioDeDetenidos = "" + data[key].puestosAplica[puestoKey].nombre;
                                } else if (data[key].puestosAplica[puestoKey].idPuesto == 4444) {

                                    agenteDeLocalizacion = "" + data[key].puestosAplica[puestoKey].nombre;
                                }
                                //console.log(data[key].puestosAplica[puestoKey].idPuesto)
                            }
                            $(
                                '<tr style="background:#f1f1f1" id="tupla'+key+'">' + '</tr>'
                            )
                            .appendTo(tablaPrimerosIngresos);
                            $(
                                '<td></td>'+
                                '<td>' + data[key].numeroConvocatoria+ '</td>' +
                                '<td>' + data[key].numeroFlujo+ '</td>' +
                                '<td>' + data[key].numeroCedula+ '</td>' +
                                '<td>' + nombrePI + '</td>' +
                                '<td>' + investigador1 + '</td>' +
                                '<td>' + agenteDeProteccion + '</td>' +
                                '<td>' + custodioDeDetenidos + '</td>' +
                                '<td>' + agenteDeLocalizacion + '</td>' +
                                '<td>' + data[key].cantidadDiasAdminPruebasGH+ '</td>' +
                                '<td>' + data[key].cantidadDiasPruebasGH+ '</td>' +
                                '<td>' + data[key].cantidadDiasAdminAntecedentes+ '</td>' +
                                '<td>' + data[key].cantidadDiasAntecedentes+ '</td>' +
                                '<td>' + data[key].cantidadDiasAdminVialidad+ '</td>' +
                                '<td>' + data[key].cantidadDiasVialidad+ '</td>' +
                                '<td>' + data[key].fechaEnvioGHTraslado+ '</td>' +
                                '<td>' + data[key].cantidadDiasAdminPruebasMedicas+ '</td>' +
                                '<td>' + data[key].cantidadDiasPruebasMedicas+ '</td>' +
                                '<td>' + data[key].cantidadDiasAdminToxicologia+ '</td>' +
                                '<td>' + data[key].cantidadDiasToxicologia + '</td>' +
                                '<td>' + data[key].instanciaPerdioProceso + '</td>' +
                                '<td>' + data[key].condicion+ '</td>' +
                                '<td>' + data[key].fechaIngreso+ '</td>' +
                                '<td>' + data[key].cantidadDiasTotalesTramite+ '</td>' 

                                
                            )
                                .appendTo("#tupla" + key);
                            

                            
                            
                        }


                    }
                    
                    //btn_BuscarFLCV.prop("disabled", false);
                }
                //console.log("It works " + this.value)
            });

        });
        $("#buscarNumConvocatoria").on('change', function () {
            selectFlujos.empty();
            if (this.value != "") {
                var url = "http://localhost:55439/api/cuadroGeneral/" + this.value;

                $.post(url, null, function (data) {

                    if (data.length === 0) {
                        alert("La convocatoria seleccionada no tiene flujos");
                    } else {
                        var size = 0;
                        for (key in data) {
                            if (data.hasOwnProperty(key)) {

                                $(
                                    '<option value="' + data[size] + '">' +
                                    data[size] +
                                    '</option>'
                                )
                                    .appendTo(selectFlujos);
                                size = size + 1;

                            }


                        }
                        $(
                            '<option value="0">Todos</option>'
                        )
                            .appendTo(selectFlujos);
                        //btn_BuscarFLCV.prop("disabled", false);
                    }
                    //console.log("It works " + this.value)
                });
            }

        });

    </script>
</body>


</html>


